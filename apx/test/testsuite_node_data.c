//////////////////////////////////////////////////////////////////////////////
// INCLUDES
//////////////////////////////////////////////////////////////////////////////
#include <assert.h>
#include <stdlib.h>
#include <string.h>
#include "CuTest.h"
#include "apx/parser.h"
#include "apx/node_instance.h"
#ifdef MEM_LEAK_CHECK
#include "CMemLeak.h"
#endif

//////////////////////////////////////////////////////////////////////////////
// PRIVATE CONSTANTS AND DATA TYPES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// PRIVATE FUNCTION PROTOTYPES
//////////////////////////////////////////////////////////////////////////////
static void test_apx_nodeData_writeDefinitionBuffer(CuTest *tc);

//////////////////////////////////////////////////////////////////////////////
// PRIVATE VARIABLES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// PUBLIC FUNCTIONS
//////////////////////////////////////////////////////////////////////////////
CuSuite* testSuite_apx_nodeData2(void)
{
   CuSuite* suite = CuSuiteNew();

   SUITE_ADD_TEST(suite, test_apx_nodeData_writeDefinitionBuffer);

   return suite;
}

//////////////////////////////////////////////////////////////////////////////
// PRIVATE FUNCTIONS
//////////////////////////////////////////////////////////////////////////////
static void test_apx_nodeData_writeDefinitionBuffer(CuTest *tc)
{
   const char *apx_text = "APX/1.2\n"
         "N\"TestNode\"\n"
         "R\"TestPort\"C:=255\n";

   apx_nodeData_t *nodeData;
   apx_size_t apx_len = (apx_size_t) strlen(apx_text);

   nodeData =  apx_nodeData_new();
   CuAssertPtrNotNull(tc, nodeData);
   CuAssertIntEquals(tc, APX_NO_ERROR, apx_nodeData_createDefinitionBuffer(nodeData, apx_len ));
   CuAssertUIntEquals(tc, (apx_size_t) strlen(apx_text), nodeData->definitionDataLen);
   CuAssertIntEquals(tc, APX_NO_ERROR, apx_nodeData_writeDefinitionData(nodeData, (const uint8_t*) apx_text, 0u, apx_len));
   apx_nodeData_delete(nodeData);

}

